# Полноценная система FW Visual Flow Studio

## Цель
FW Visual Flow Studio — единая среда, где дизайнеры, продуктовые команды и разработчики собирают интерфейсы,
сценарии, данные и тесты в общем рабочем контуре и публикуют их в web/desktop/terminal без дублирования логики.

## Состав системы (верхний уровень)
1. **Visual Editor** — канвас, инспектор, слой данных и событий, история изменений.
2. **Scenario Engine** — сценарный рантайм, оркестрация экранов, условные ветвления.
3. **Component Repository** — реестр компонентов, версии, стабильность, зависимости.
4. **Data Model Layer** — единые сущности, схемы и реактивные подписки.
5. **Test Recorder** — запись действий, генерация и запуск автотестов.
6. **Publish Pipeline** — сборка целевых пакетов (web, desktop, terminal).
7. **Event Router** — маршрутизация событий, интеграции с бэкендом.
8. **Access & Collaboration** — роли, права, ревью, совместное редактирование.

## Proof of Concept: статус
- UI прототип доступен и поднимается локально.
- Компоненты рендерятся через React + Vite.
- Документация и структура готовы к Vocs.

## Пользовательские роли
- **Designer** — собирает экраны, связывает события, выбирает компоненты.
- **Product** — управляет сценариями, метриками, продуктовой аналитикой.
- **Developer** — развивает компоненты, настраивает интеграции, CI/CD.
- **QA** — записывает и запускает тесты, управляет окружениями.
- **Admin** — управляет каталогом, доступами, лицензиями.

## Модель данных
### Сущности
- **Project**: имя, описание, целевые платформы, версии.
- **Screen**: layout, компоненты, связки событий, сохранённое состояние.
- **Scenario**: узлы, переходы, условия, контракты входов/выходов.
- **Component**: метаданные, API (props/events/methods), версия, статусы.
- **Dataset**: схемы, источники данных, режимы (mock/live).
- **Test Case**: шаги, ассерты, окружения, история прогонов.

### Реактивность
Компоненты подписываются на сущности и получают обновления через единый стор. Сценарий управляет
потоками данных и умеет переключать источники на уровне окружения (mock → stage → prod).

## Жизненный цикл артефактов
1. **Создание**: экран/сценарий создаётся в редакторе из шаблона.
2. **Сборка**: валидируются контракты данных, события, версии компонентов.
3. **Тестирование**: сценарий записывается в автотест, запускается в CI.
4. **Публикация**: артефакты компилируются в целевые пакеты.
5. **Эксплуатация**: метрики, логи событий, мониторинг стабильности.

## Канонический JSON-формат
Система хранит экраны и сценарии в JSON, чтобы единая модель была переносимой.

```json
{
  "screen": "EnterPhoneNumber",
  "components": [
    {
      "type": "phoneInput",
      "props": { "operator": "auto", "phone": "" },
      "events": { "valid": "screen.next" }
    }
  ],
  "state": { "phone": "" }
}
```

## Сценарный рантайм
- **Условия**: `if/else`, локальные переменные, доступ к state.
- **События**: `screen.next()`, `screen.back()`, `query()`.
- **Сохранение**: шаги и состояние сохраняются как тестовый сценарий.

## Каталог компонентов
### Метаданные
- Статус: draft / stable / deprecated.
- Совместимость: web/desktop/terminal.
- Контракты: props/events/methods, схема данных.

### Политики версионирования
- SemVer + статусы стабильности.
- Обязательные миграции при breaking changes.
- Автоматический линтинг API.

## Интеграции
- **Backend API**: REST/gRPC/GraphQL через Event Router.
- **Analytics**: события сценариев, конверсии, тайминги.
- **CI/CD**: автотесты и сборки по веткам.

## Безопасность и доступы
1. **RBAC**: роли и разрешения на уровне проекта.
2. **Audit log**: кто и когда изменял артефакты.
3. **Secrets**: хранение токенов и ключей по окружениям.

## Экосистема и расширения
- **Плагины редактора**: новые панели/инспекторы.
- **Компонентные SDK**: шаблоны для быстрого создания компонентов.
- **Marketplace**: публикация сторонних библиотек.

## План развития (чек-лист)
- [ ] MVP: базовый редактор, сценарный рантайм, ядро компонентов.
- [ ] v0.9: шаблоны, модель данных, автотесты, библиотека компонентов.
- [ ] v1.0: публикация на все платформы, каталог и marketplace.

